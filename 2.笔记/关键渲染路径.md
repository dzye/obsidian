## 关键渲染路径
**关键渲染路径**(**Critical Rendering Path**)是浏览器将 HTML，CSS 和 JavaScript 转换为屏幕上的像素所经历的步骤序列。优化关键渲染路径可提高渲染性能。

### 步骤
在解析 HTML 时会创建 DOM，HTML 可以请求 JavaScript，而 JavaScript 反过来，又可以更改 DOM。HTML 包含或请求样式，依次来构建 CSSOM。
浏览器引擎将两者结合起来以创建 Render Tree (渲染树)，Layout(布局)确定页面上所有内容的大小和位置，确定布局后，将像素 Paint (绘制)到屏幕上。
![[Pasted image 20220427231219.png]]
1. 生成DOM
		DOM 构建是增量的。浏览器从远程下载 `Byte` => 根据相应的编码 (如 utf8) 转化为`字符串` => 通过 AST 解析为 `Token` => 生成 `Node` => 生成 `DOM`。
		![[Pasted image 20220427225855.png]]
2. 生成CSSOM
	CSS 是渲染阻塞的：浏览器会阻塞页面渲染直到它接收和执行了所有的 CSS。CSS 是渲染阻塞是因为规则可以被覆盖，所以内容不能被渲染直到 CSSOM 的完成。
3. Render Tree
	渲染树(Render Tree)包括了内容和样式：DOM 和 CSSOM 树结合为渲染树
4. Layout
	布局这个步骤决定了在哪里和如何在页面上放置元素，决定了每个元素的宽和高，以及他们之间的相关性。这一步发生重排
5. Paint
	将像素绘制在屏幕上，栅格化所有元素，将元素转换为实际像素。这一步发生重绘

### javascript与关键渲染路径
js执行在生成渲染树之前，因此会阻塞页面的渲染，如此设计原因是为了得到的DOM准确，而不是一边构建，一遍js修改。

### 性能优化
1.  减少 DOM 树渲染时间（譬如降低 HTML 层级、标签尽量语义化等等）
2.  减少 CSSOM 树渲染时间（降低选择器层级等等）
3.  减少 HTTP 请求次数及请求大小
4.  将 css 放在页面开始位置
5.  将 js 放在页面底部位置，并尽可能用 defer 或者 async 避免阻塞的 js 加载，确保 DOM 树生成完才会去加载 JS
6.  用 link 替代@import
7.  如果页面 css 较少，尽量使用内嵌式
8.  为了减少白屏时间，页面加载时先快速生成一个 DOM 树